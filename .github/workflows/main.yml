name: Format Lua with Stylua

on:
  push:
    branches:
      - main
  pull_request:

jobs:
  stylua:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout Repo
      uses: actions/checkout@v3

    - name: Install Stylua
      run: |
        curl -sSfL https://github.com/JohnnyMorganz/StyLua/releases/latest/download/stylua-linux.zip -o stylua.zip
        unzip stylua.zip -d stylua
        sudo mv stylua/stylua /usr/local/bin/
        stylua --version

    - name: Format Lua Files
      run: stylua .

    - name: Commit and Push Changes
      run: |
        git config --global user.name "github-actions[bot]"
        git config --global user.email "github-actions[bot]@users.noreply.github.com"
        git add .
        git diff-index --quiet HEAD || git commit -m "Format Lua with Stylua"
        git push
